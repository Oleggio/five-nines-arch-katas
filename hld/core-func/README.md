# Core Functionality Overview

## Overview

MobiCorp's core services support the fundamental business operations,
enabling users to discover, reserve, and ride e-bikes, scooters, cars and vans across the city.
The platform is built on GCP ([ADR-0001](../../adrs/ADR-0001%20-%20GCP%20as%20main%20cloud%20provider.md)) to leverage native Maps integration,
scalable real-time data handling, and seamless AI/ML capabilities.
Vehicle connectivity is maintained through MQTT gateways integrated with GCP IoT Platform ([ADR-0002](../../adrs/ADR-0002%20-%20Vehicle%20telemetry%20&%20integration%20stack.md)),
ensuring reliable telemetry and command exchange for thousands of connected devices.

## Container View

| Container Name  | Functionality Overview                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
|-----------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Mobile App      | User interface for accessing MobiCorp rental functionality. Enables users to search for nearby vehicles on an interactive map, reserve or book them instantly. Features a hybrid chatbot combining predefined options for quick actions with conversational AI for trip planning and recommendations. The AI assistant helps users plan short trips and discover sightseeing recommendations. Users can provide free-text feedback on various aspects of their experience, including route quality, ride comfort, and vehicle discoverability at specific locations. |
| API Gateway     | Provides authentication, push notifications, session management and communicates with different backend services.                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Fleet Service   | Acts as the single source of truth for vehicle state ([ADR-0007](../../adrs/ADR-0007%20-%20Fleet%20Service%20as%20the%20Single%20Source%20of%20Truth%20for%20Vehicle%20State.md)). Manages vehicle location tracking, reservation capabilities, and remote vehicle control operations including lock, unlock, and disable commands. Receives telemetry from MQTT gateway via Pub/Sub, updates real-time state, and implements configurable rules (e.g., charge threshold, geofencing) to trigger operational actions.                                                |
| Ride Service    | Initiates the ride, calculates ride total cost at the end of a ride.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| Payment Gateway | Reserves payments, charges users.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Price Service   | Offers dynamic price for each user based on different conditions.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| Pub/Sub         | Message broker to allow services communicate asynchronously for better throughput. Serves as the streaming backbone for telemetry ingestion from vehicles.                                                                                                                                                                                                                                                                                                                                                                                                           |
| MQTT Broker     | Clustered MQTT gateway on Kubernetes fronted by a load balancer for device connectivity ([ADR-0002](../../adrs/ADR-0002%20-%20Vehicle%20telemetry%20&%20integration%20stack.md)). Relays messages to and from vehicles through GCP IoT platform (bidirectional) using lightweight MQTT protocol optimized for constrained IoT devices.                                                                                                                                                                                                                               |
| Vehicle         | Notifies about its location and battery status (charge, temperature) via MQTT.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| User Service    | Stores user preferences, favourite transport, routes, etc to personalize experience and build loyalty.                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| Vertex AI       | Core platform for AI and GenAI capabilities ([ADR-0003](../../adrs/ADR-0003%20-%20Vertex%20AI%20as%20core%20platform%20for%20AI%20and%20GenAI.md)). Provides demand forecasting, route optimization models, and conversational AI features. Integrates natively with Google Maps for geospatial intelligence and supports end-to-end ML lifecycle including training, serving, and orchestration.                                                                                                                                                                    |

![Diagram](Core%20Containers.drawio.png)
